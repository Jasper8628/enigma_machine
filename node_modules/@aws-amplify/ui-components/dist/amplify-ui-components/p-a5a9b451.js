import{Logger as e,isEmpty as r}from"@aws-amplify/core";import{A as t,C as o}from"./p-417bb5ea.js";import{Auth as s}from"@aws-amplify/auth";import{N as a}from"./p-2915ed18.js";import{a as n}from"./p-b7cf913b.js";const i=new e("auth-helpers");async function c(e,o){if(!s||"function"!=typeof s.verifiedContact)throw new Error(a);try{const a=await s.verifiedContact(e);if(!r(a.verified)||r(a.unverified))o(t.SignedIn,e);else{const r=Object.assign(e,a);o(t.VerifyContact,r)}}catch(i){n(i)}}const f=async(e,r,f)=>{if(!s||"function"!=typeof s.signIn)throw new Error(a);try{const a=await s.signIn(e,r);i.debug(a),a.challengeName===o.SMSMFA||a.challengeName===o.SoftwareTokenMFA?(i.debug("confirm user with "+a.challengeName),f(t.ConfirmSignIn,a)):a.challengeName===o.NewPasswordRequired?(i.debug("require new password",a.challengeParam),f(t.ResetPassword,a)):a.challengeName===o.MFASetup?(i.debug("TOTP setup",a.challengeParam),f(t.TOTPSetup,a)):a.challengeName===o.CustomChallenge&&a.challengeParam&&"true"===a.challengeParam.trigger?(i.debug("custom challenge",a.challengeParam),f(t.CustomConfirmSignIn,a)):await c(a,f)}catch(p){n(p),"UserNotConfirmedException"===p.code?(i.debug("the user is not confirmed"),f(t.ConfirmSignUp,{username:e})):"PasswordResetRequiredException"===p.code&&(i.debug("the user requires a new password"),f(t.ForgotPassword,{username:e}))}};export{c,f as h}